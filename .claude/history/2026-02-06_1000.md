# Change Log: 2026-02-06

## Summary
Reworked stat cap penalty system: percentage-based with time factor, cross-training awareness, and enable toggle.

## Changes Made

### `config.json`
- Removed `avg_gain_per_day` and `training_ratio`
- Added `enabled: true` flag
- Added `start_penalty_percent: 60`

### `core/logic.py`
- Added `TRAINING_SECONDARY_STATS` mapping:
  - SPD → PWR (30%), STA → GUTS (30%), PWR → STA (30%)
  - GUTS → SPD (30%) + PWR (30%), WIT → SPD (10%)
- Replaced `calculate_stat_cap_penalty()` with `_calculate_single_stat_penalty()`
  - Returns penalty_percent (0 to max) based on fill_factor × time_factor
  - Max day: 73
- Reworked `apply_stat_cap_penalties()`:
  - Checks `enabled` flag before applying
  - Calculates primary penalty (the stat being trained)
  - Calculates secondary penalties (stats receiving secondary gains, scaled by ratio)
  - Takes max(primary, max_secondary) — not cumulative
- `filter_by_stat_caps()`: Also checks `enabled` flag
- Fixed inconsistent threshold_day default (was 60 in filter, 30 elsewhere)

### `gui/dialogs/config_dialog.py`
- Added "Enable Stat Cap Penalty" checkbox
- Updated labels/tooltips for clarity

## Cross-Training Penalty Example
Training PWR when STA (target 500) is at 400:
1. PWR primary penalty: based on PWR stat vs PWR target
2. STA secondary penalty: STA_penalty × 0.3 (because PWR training gives 30% to STA)
3. Final penalty = max(PWR_penalty, STA_penalty_scaled)
