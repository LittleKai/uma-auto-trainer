# Change Log: 2026-02-19 12:00

## Session Info
- **Type:** Feature
- **Request:** "Add Check Uma Event and unified Check Update dialog"
- **Files Modified:** 3
- **Files Created:** 2
- **Files Deleted:** 0

---

## Changes Made

### 1. Event Map Update Functions in core/updater.py
**What changed:**
- Added `check_event_updates()` function that uses GitHub Contents API to compare local event map files with the repository
- Added `download_event_files()` function to download new/updated event files
- Added helper functions: `_compute_git_blob_sha()`, `_fetch_github_dir()`, `_fetch_github_file_info()`, `_get_app_dir()`
- Compares files using git blob SHA1 hash (same algorithm GitHub uses)
- Checks all event_map subdirectories: uma_musume, support_card/{spd,sta,pow,gut,wit,frd}, and root JSON files

**Files affected:**
- `core/updater.py`

### 2. EventUpdateDialog
**What changed:**
- Created new dialog following existing UpdateDialog pattern (Toplevel, transient, grab_set)
- Shows file list with Treeview (file path + New/Updated status)
- Progress bar during download with per-file progress
- "Update All" and "Close" buttons
- Summary message on completion

**Files affected:**
- `gui/dialogs/event_update_dialog.py` (new)

### 3. CheckUpdateDialog (unified update menu)
**What changed:**
- Created dialog that opens when clicking "Check Update" button
- Contains auto-check update toggle (saved to bot_settings.json as `auto_check_update`)
- "Check Update" button for app version updates
- "Check Uma Event" button for event map updates
- Both buttons disable during checking, show status label
- On results: closes dialog and opens appropriate detail dialog, or shows messagebox

**Files affected:**
- `gui/dialogs/check_update_dialog.py` (new)
- `gui/dialogs/__init__.py`

### 4. Main Window Changes
**What changed:**
- Removed separate "Check Uma Event" button from header
- "Check Update" button now opens CheckUpdateDialog
- Startup auto-check respects `auto_check_update` setting from bot_settings.json
- Added `_open_check_update_dialog()`, simplified update callback methods

**Files affected:**
- `gui/main_window.py`

---

## Testing Performed
- [ ] Run `python main.py` - GUI loads correctly
- [ ] Click "Check Update" - dialog opens with toggle + 2 buttons
- [ ] Toggle auto-check - setting saved to bot_settings.json
- [ ] Click "Check Update" in dialog - checks app version
- [ ] Click "Check Uma Event" in dialog - checks event maps
- [ ] Verify event update dialog shows with file list
- [ ] Click "Update All" to download files
- [ ] Verify "All event maps are up to date" message when no updates

---

## Documentation Updates
- [x] Updated PROJECT_SUMMARY.md (sections 2, 4, 7)
- [x] Created history entry

---

## Known Issues / TODOs Added
- GitHub API has rate limits (60 requests/hour for unauthenticated)
- Each directory listing is a separate API call

---

**Status:** Completed
