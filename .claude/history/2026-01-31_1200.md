# Change Log: 2026-01-31 12:00 - 14:00

## Summary
Moved stat caps configuration from global config.json to per-preset settings, allowing each of the 20 presets to have unique stat cap values. Added a Config Editor dialog accessible via a new "Config" button in the header.

## Changes Made

### 1. Per-Preset Stat Caps
**Files Modified:**
- `gui/tabs/event_choice_tab.py`
  - Added `stat_caps` dictionary to each preset (SPD, STA, PWR, GUTS, WIT)
  - Added `create_stat_caps_section()` method for UI
  - Added `_on_stat_cap_change()` and `_update_logic_stat_caps()` methods
  - Added `_update_stat_cap_entries()` method for preset switching
  - Updated `get_settings()` and `load_settings()` to include stat_caps

- `core/logic.py`
  - Added `DEFAULT_STAT_CAPS` constant
  - Added `set_stat_caps(new_stat_caps)` function to update stat caps dynamically
  - Added `get_stat_caps()` function to retrieve current stat caps
  - Modified to support dynamic stat caps from GUI presets

- `config.json`
  - Removed `stat_caps` from root level (now managed per-preset)

### 2. Config Editor Dialog
**Files Created:**
- `gui/dialogs/config_dialog.py`
  - New dialog with 3 tabs: Basic Settings, Scoring Config, Stage & Multipliers
  - Allows editing: priority stat order, energy percentages, scoring values
  - Includes "Reset to Defaults" functionality
  - Modal dialog with save/cancel buttons

**Files Modified:**
- `gui/main_window.py`
  - Added "Config" button next to "Region Settings" button
  - Added `open_config_settings()` method

## Testing Notes
- [ ] Verify preset switching updates stat cap values correctly
- [ ] Verify stat caps are saved/loaded with bot_settings.json
- [ ] Verify config dialog saves values correctly to config.json
- [ ] Test that training logic uses the correct stat caps per preset

## Rollback Instructions
To rollback these changes:
1. Restore `config.json` with `stat_caps` at root level
2. Revert changes in `core/logic.py` to use hardcoded STAT_CAPS
3. Remove stat_caps UI from `gui/tabs/event_choice_tab.py`
4. Delete `gui/dialogs/config_dialog.py`
5. Remove config button from `gui/main_window.py`

## Related Files
- `bot_settings.json` - Will now contain stat_caps per preset
- `config.json` - No longer contains stat_caps

---

# Change Log: 2026-01-31 14:00 - Global Deck Info & Deck-Based Event Conditions

## Summary
Added global deck information storage in utils/constants.py and deck-based event conditions in event handler. Also improved config dialog with horizontal drag-and-drop buttons for priority stat order.

## Changes Made

### 1. Global Deck Info in utils/constants.py
- Added `CURRENT_DECK` global dictionary containing:
  - `uma_musume`: Selected Uma Musume name
  - `support_cards`: List of 6 support card strings
  - `stat_caps`: Current stat caps dictionary
  - `card_type_counts`: Count of each card type in deck

- New functions:
  - `set_deck_info(uma_musume, support_cards, stat_caps)`: Set deck info from GUI
  - `get_deck_info()`: Get complete deck info
  - `get_deck_card_count(card_type)`: Get count of specific card type
  - `get_stat_caps()`: Get current stat caps
  - `deck_has_card_type(card_type, min_count)`: Check if deck has enough cards

### 2. Deck-Based Event Conditions in event_handler.py
- Added `_check_deck_condition()` method to EventChoiceHandler
- Supports condition format: `"choice_X_if_deck_has_Y_Z"`
  - X = choice number (1-5)
  - Y = minimum count required
  - Z = card type (spd, sta, pwr, guts, wit, frd)
- Example: `"choice_1_if_deck_has_2_spd"` = choice 1 if deck has 2+ speed cards
- Also supports: `"choice_X_if_deck_has_TYPE": count` format

### 3. Config Dialog Improvements
- Replaced vertical listbox with horizontal drag-and-drop buttons for priority stat
- Each stat has a colored button that can be dragged left/right
- Visual indicators show "High" (left) and "Low" (right) priority

### 4. Logic Module Updates
- `core/logic.py` now uses `utils/constants.py` as single source of truth for stat_caps
- `get_stat_caps()` fetches from constants module
- `set_stat_caps()` updates constants module

## Event Condition Examples

```json
{
  "name": "Event Name",
  "choice_1_if_deck_has_2_spd": true,
  "choice_2_if_deck_has_3_wit": true,
  "default_choice": 1
}
```

Or using the count value format:
```json
{
  "name": "Event Name",
  "choice_1_if_deck_has_spd": 2,
  "choice_2_if_deck_has_wit": 3,
  "default_choice": 1
}
```

## Testing Notes
- [ ] Verify deck info updates when switching presets
- [ ] Test deck-based event conditions in event map JSON files
- [ ] Verify drag-and-drop priority stat buttons work correctly
- [ ] Check stat caps are correctly passed from constants to logic module
