# Change Log: 2026-02-04 14:00

## Session Summary
Implemented the "Junior Style Selection" feature for auto-selecting running style at debut.

## Changes Made

### New Files
1. **core/style_handler.py**
   - `StyleHandler` class for detecting and handling style selection
   - Template matching for style selection screen detection
   - Style button detection using pyautogui and OpenCV
   - `STYLE_MAP`: Japanese to English style mapping (逃げ→nige, 先行→senkou, etc.)
   - `UMA_STYLE_MAP`: Character to recommended style mapping (40+ characters)
   - Auto mode selects style based on character recommendation
   - Fallback to position-based selection if templates not found
   - Methods: `is_style_selection_screen()`, `select_style()`, `handle_style_selection()`

### Modified Files
1. **gui/tabs/event_choice_tab.py**
   - Added debut style variables: `debut_style_enabled`, `debut_style`, `debut_style_fallback`
   - Created `create_debut_style_section()` method for UI
   - UI includes: Enable checkbox, Style dropdown, Fallback dropdown
   - Updated `get_settings()` to include debut_style settings
   - Updated `load_settings()` to load debut_style settings
   - Imported `get_style_options`, `get_style_display_name` from style_handler

2. **core/execute_helpers.py**
   - Imported `StyleHandler`
   - Added `style_handler` instance to `EventHandler.__init__()`
   - Added `_handle_style_selection()` method
   - Integrated style selection as first priority in `handle_ui_elements()`

## Required Template Images (PENDING)

The following template images need to be captured from the actual game:

### Screen Detection
- `assets/scenario/style_selection.png` - Style selection screen header/indicator

### Style Buttons (in `assets/buttons/style/` folder)
- `assets/buttons/style/front.png` - Front (逃げ) button
- `assets/buttons/style/pace.png` - Pace (先行) button
- `assets/buttons/style/late.png` - Late (差し) button
- `assets/buttons/style/end.png` - End (追込) button

### Confirm Button
- `assets/buttons/style/confirm.png` - Confirm/OK button after style selection

### Capture Guidelines
1. Take screenshots at 1920x1080 resolution
2. Crop to just the button/element with minimal surrounding area
3. Save as PNG with alpha channel if possible
4. Test with confidence threshold 0.8

## Settings Schema

Added to `bot_settings.json` under `event_choice`:
```json
{
  "debut_style": {
    "style": "none"
  }
}
```

Style options: `none`, `front`, `pace`, `late`, `end`
- `none` = Feature disabled
- When Uma Musume selection changes, debut_style auto-resets to `none`

## Style Options

| Style ID | Display Name | Japanese |
|----------|-------------|----------|
| none | None | - |
| front | Front (逃げ) | 逃げ |
| pace | Pace (先行) | 先行 |
| late | Late (差し) | 差し |
| end | End (追込) | 追込 |

## Testing Checklist
- [ ] Template images created and placed in correct directories
- [ ] Style selection screen is detected correctly
- [ ] Style buttons are clicked successfully
- [ ] Confirm button is clicked after selection
- [ ] Auto mode selects correct style for known characters
- [ ] Fallback works when primary style not available
- [ ] Settings save and load correctly
- [ ] UI dropdown shows correct options

## Notes
- Feature is implemented but requires template images to function
- Fallback to position-based clicking is available if templates fail
- Default style is 'senkou' (Stalker) if character not in mapping
